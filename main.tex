\documentclass{article}


\usepackage{mystyle}
\usepackage{mycommands}
\usepackage{lmodern}

\usepackage{todonotes}
\input{macros.tex}

\title{Continuous Reinforcement Learning}

\author{L\'eonard Blier, Corentin Tallec}
  

\begin{document}
\maketitle


\begin{abstract}
Abstract
\end{abstract}

\section{Introduction}
\label{sec:introduction}


\section{Definitions and Notations}
\label{sec:definitions}

\begin{definition}[Continuous Markov Reward Process]
  A continuous markov reward process $(X_{t}, R_{t})_{t\in\BR_{+}}$ is a continuous random process defined by 
  \begin{itemize}
  \item $\mathcal{X}$ is the state set 
  \item $T(x)$ the dynamics and $\Sigma (x)$ the noise
  \item $\mathcal{R}(r|x)$ the reward law
  \item $\gamma$ the discount factor
  \end{itemize}
  The law for the process $X_{t}$ is given by
  \begin{equation}
    \label{eq:eqdiffstoch}
    dX_{t} = T(X_{t}) + \Sigma(X_{t})dB_{t}
  \end{equation}
\end{definition}


\begin{definition}[Discretization of the space]
  A discretization of the space $(\mathcal{X}, \BR_{+})$ is a $(X, \delta t)$ where :
  \begin{itemize}
  \item $X$ is a partition of $X$
  \item $\delta t > 0$
  \end{itemize}
  We define the precision $\delta(X)$ of the partition $X$ to be :
  \begin{equation}
    \label{eq:2}
    \delta(X) = \sup_{s\in X}\sup_{x,y \in s}\|x-y\|
  \end{equation}
\end{definition}

\begin{definition}[Convergence of discretizations]
  We say that a sequence $(X_{k}, \delta t_{k})$ of discretizations of $\mathcal{X}$ converges if $(\delta(X_{k}), \delta t_{k}) \rightarrow 0$. 
\end{definition}


\begin{definition}[Discretization of a Markov Reward Process]
  Let $(\mathcal{S}, T, R, \gamma)$ be a continuous MRP, and $(S, \delta t)$ a discretization of $\mathcal{X}$. We define the approximation of the continuous MRP associated to this discretization as the discrete MRP $(\tilde S, \tilde{T}, \tilde{R}, \tilde{\gamma})$ where :
  \begin{itemize}
  \item $\tilde{T}(s,s') = \BP(X_{t+\delta t}\in s' | X_{t}\in s)$. \todo{Formalize that $X_{t}$ uniform in $s$}
  \item $R(s) \sim \int_{t}^{t+\delta t}R_{t'}dt'$\todo{idem}
  \item $\tilde{\gamma} = \gamma^{\delta t}$ 
  \end{itemize}
\end{definition}


\begin{theorem}
  Let $(X_{t}, R_{t})$ be a continuous MRP, and $(X_{k}, \delta t_{k})$ a sequence of approximations which converges to $\mathcal{X}$. Let $(\tilde{X}^{k}_{t}, \tilde{R}^{k}_{t})$ be the associated discretization. Then, for all $T > 0$,
  \begin{equation}
    (X^{k}_{t}, R^{k}_{t})_{0 \leq t \leq T} \rightarrow (X_{t}, R_{t})_{0 \leq t \leq T}
  \end{equation}
\end{theorem}

We define the operators on $\mathcal{M}$ :
\begin{itemize}
\item $U_{S}\mu = \sum_{s \in S}\frac{\mu(s)}{\ell(s)}1_{s}$
\item $P_{S}\mu = \sum_{s \in S}\frac{\mu(s)}{\ell(s)}\delta_{x_{s}}$
\item Family $(T_{t})_{t\in \BR_{+}}$, $T_{t}\mu$ is the law of $X_{t}$ if $X_{0}\sim \mu$.
\item For a given $\delta t$, $\tilde{T}_{t}\mu$ is the law of $\tilde{\tilde X}_{t}$ if $X_{0}\sim \mu$. We have :
  \begin{equation}
    \tilde{T}_{\delta t} = P_{S}T_{\delta t}U_{S}
  \end{equation}
  and
  \begin{equation}
    \tilde{T}_{t} = \tilde{T}_{\delta t}^{\lfloor t/\delta t\rfloor}
  \end{equation}
\end{itemize}
In the following, $W = W_{2}$ is the Wasserstein distance.
\begin{lemma}
  \begin{equation}
    W(U_{S}\mu, \mu) \leq \delta(S)
  \end{equation}
  \begin{equation}
    W(P_{S}\mu, \mu) \leq \delta(S)
  \end{equation}
  \begin{equation}
    U_{S}P_{S} = U_{S}
  \end{equation}
  \begin{equation}
    P_{S}U_{S} = P_{S}
  \end{equation}
\end{lemma}

\begin{lemma}
  Assume that $T$ is Lipschitz and $\mathcal{X}$ is compact, 
  \begin{equation}
    W(T_{t}\mu, T_{t}\nu) \leq (1+Ct)W(\mu, \nu)
  \end{equation}
\end{lemma}

\begin{proof}
  \todo{todo} IDEA : stability of $T$ and $\Sigma$
\end{proof}

\begin{lemma}
   Let $(S_{k}, \delta t_{k})$ be a sequence of approximations which converges to $\mathcal{X}$ such that $\varepsilon_{k} := \frac{\delta(S_{k})}{\delta t_{k}} \rightarrow 0$. Let $(\tilde{X}^{k}_{t}, \tilde{R}^{k}_{t})$ be the associated discretization. Then, for all $t > 0$,
  \begin{equation}
    W(\tilde T^{k}_{t}\mu, T_{t}\nu) \leq W(\mu,\nu)e^{tC} + o_{k\rightarrow \infty}(1)
  \end{equation}
\end{lemma}

\begin{proof}
  Let $(S,\delta t)$ be a discretization.


  \begin{align}
    W(\tilde T_{\delta t}\mu, T_{t}\nu) &= \\
  W(P_{S}(T_{\delta t}U_{S})^{\lfloor t/\delta t\rfloor}\mu , T_{t}\nu) &\leq \\ W(T_{\lfloor t/\delta t\rfloor \delta t}\mu, T_{t}\mu) + \delta(S) + W((T_{\delta t}U_{S})^{\lfloor t/\delta t\rfloor}\mu , T_{\delta t}^{\lfloor t/\delta t\rfloor}\nu)
  \end{align}
  
  But
  \begin{equation}
  W(T_{\lfloor t/\delta t\rfloor \delta t}\mu, T_{t}\mu) = W(T_{\delta t\{t/\delta t\}}\nu , \nu) \leq C_{1}\delta t
\end{equation}
Moreover :
\begin{align}
  W((T_{\delta t}U_{S})^{n}\mu , T_{\delta t}^{n}\nu) &= W(T_{\delta t}\left(U_{S}(T_{\delta t}U_{S})^{n-1}\mu\right) , T_{\delta t}\left(T_{\delta t}^{n-1}\nu\right)) \\
                                                      &\leq (1+C\delta t)  W(U_{S}(T_{\delta t}U_{S})^{n-1}\mu , T_{\delta t}^{n-1}\nu)\\
  & \leq (1+C\delta t)  (\delta(S) + W((T_{\delta t}U_{S})^{n-1}\mu , T_{\delta t}^{n-1}\nu))
\end{align}
Then, by induction :
\begin{align}
  W((T_{\delta t}U_{S})^{n}\mu , T_{\delta t}^{n}\mu) &\leq (1+C\delta t)\delta(S)\frac{(1+C\delta t)^{n} - 1}{C\delta t} + W(\mu, \nu)(1+C\delta t)^{n}
\end{align}
Therefore :
\begin{align}
  W((T_{\delta t}U_{S})^{\lfloor t/\delta t\rfloor}\mu , T_{\delta t}^{\lfloor t/\delta t\rfloor}\mu) &\leq (1+C\delta t)\delta(S)\frac{(1+C\delta t)^{\lfloor t/\delta t\rfloor} - 1}{C\delta t} + W(\mu, \nu)(1+C\delta t)^{\lfloor t/\delta t\rfloor} \\
                                                                                                      &\leq (1+C\delta t)\delta(S)\frac{e^{tC} - 1}{C\delta t} + W(\mu, \nu)e^{tC}\\
                                                                                                        &= W(\mu, \nu)e^{tC} + o(1)
\end{align}
Therefore, 
\begin{align}
  W(P_{S}(T_{\delta t_{k}}U_{S_{k}})^{\lfloor t/\delta t_{k}\rfloor}\mu, T_{t}\mu) & \leq W(\mu, \nu)e^{tC} + o(1) + \delta(S_{k}) + C'\delta t_{k}  \\
  &= W(\mu, \nu)e^{tC} + o(1)
\end{align}
\end{proof}

\begin{lemma}
  Let $0 < t_{1} < ... < t_{l}<T$.
  \begin{equation}
    W((\tilde X_{t_{1}}, ..., \tilde X_{t_{l}}), (X_{t_{1}}, ..., X_{t_{l}})) \leq W(\mu,\nu)(e^{t_{1}C}+...+e^{t_{l}C}) + o(1)
  \end{equation}
\end{lemma}

\begin{proof}
  Let $P$ be the law of $(X_{t_{1}}, ..., X_{t_{l}})$ with $X_{0} \sim \nu$, and $\tilde P$ be the law of $(\tilde X_{t_{1}}, ..., \tilde X_{t_{l}})$ with $X_{0} \sim P_{s}\mu$.
  For all $\mu, \nu$, we use the notation $\pi_{\mu,\nu}$ for a measure achieving the optimal transport distance up to $\epsilon$.

  We define :
  \begin{align}
    \pi((\tilde x_{1},..., \tilde x_{l}), (x_{1}, ..., x_{l})) = \\ = \pi_{\tilde T_{t_{1}}\mu T_{t_{1}\nu}}(\tilde x_{1}, x_{1})\prod_{i=2}^{l}\pi_{\tilde T_{t_{i}-t_{i-1}}\delta_{\tilde x_{i-1}}, T_{t_{i}-t_{i-1}}\delta_{x_{i-1}}}(\tilde x_{i}, x_{i})
  \end{align}
  Then,
  \begin{align}
    & W((\tilde X_{t_{1}}, ..., \tilde X_{t_{l}}), (X_{t_{1}}, ..., X_{t_{l}}))
    \\ & \leq \int_{(\tilde x_{1},..., \tilde x_{l}), (x_{1},..., x_{l})}\sum_{i=1}^{l}\|\tilde x_{i} - x_{i}\|^{2}\pi((\tilde x_{1},..., \tilde x_{l}), (x_{1}, ..., x_{l}))
         \\ &\leq  W((\tilde X_{t_{1}}, ..., \tilde X_{t_{l-1}}), (X_{t_{1}}, ..., X_{t_{l-1}})) + \int_{(\tilde x_{1},..., \tilde x_{l}), (x_{1},..., x_{l})}\|\tilde x_{l} - x_{l}\|^{2}\pi((\tilde x_{1},..., \tilde x_{l}), (x_{1}, ..., x_{l}))
  \end{align}

  But we have :
  \begin{align}
    \int_{(\tilde x_{1},..., \tilde x_{l}), (x_{1},..., x_{l})}\|\tilde x_{l} - x_{l}\|^{2}\pi((\tilde x_{1},..., \tilde x_{l}), (x_{1}, ..., x_{l}))  \\
    \leq \int_{(\tilde x_{1},..., \tilde x_{l-1}), (x_{1},..., x_{l-1})}W(\tilde T_{t_{l}-t_{l-1}}\delta_{\tilde x_{l-1}}, T_{t_{l}-t_{l-1}}\delta_{x_{l-1}})^{2}\pi((\tilde x_{1},..., \tilde x_{l-1}), (x_{1}, ..., x_{l-1}))\\
    \leq \int_{(\tilde x_{1},..., \tilde x_{l-1}), (x_{1},..., x_{l-1})}(W(\delta_{\tilde x_{l-1}}, \delta_{x_{l-1}})^{2}e^{(t_{l}-t_{l-1})C}+\varepsilon)\pi((\tilde x_{1},..., \tilde x_{l-1}), (x_{1}, ..., x_{l-1}))\\
    \leq \int_{(\tilde x_{1},..., \tilde x_{l-1}), (x_{1},..., x_{l-1})}(\|\tilde x_{l-1} - x_{l-1}\|^{2}e^{(t_{l}-t_{l-1})C}+\varepsilon)\pi((\tilde x_{1},..., \tilde x_{l-1}), (x_{1}, ..., x_{l-1}))
  \end{align}
  
  By induction :
  \begin{align}
    & W((\tilde X_{t_{1}}, ..., \tilde X_{t_{l}}), (X_{t_{1}}, ..., X_{t_{l}}))
    \\ &\leq  W((\tilde X_{t_{1}}, ..., \tilde X_{t_{l-1}}), (X_{t_{1}}, ..., X_{t_{l-1}})) + W(\mu,\nu)e^{t_{l}C}
    \\ &\leq W(\mu,\nu)(e^{t_{1}C}+...+e^{t_{l}C}) + o(1)
  \end{align}
\end{proof}



\begin{proof}[Proof of the theorem]
  We use theorem 13.5 from Billingsley \todo{cite}. We have to check two hypothesis :
  \begin{enumerate}
  \item For all $t_{1}<t_{2}<...<t_{l}<T$, $(X_{t_{1}}^{k}, ..., X_{t_{l}}^{k}) \rightarrow (X_{t_{1}}, ..., X_{t_{l}})$ weakly.
  \item For all $r \leq s \leq t$, $\BE\left[|X_{s}-X_{r}|^{2}|X_{t}-X_{s}|^{2}\right] \leq (F(t) - F(r))^{2}$ where F is a continuous non-decreasing function.
  \end{enumerate}
  For the first point, done in Lemma
  
  For the second point \todo{To formalize}:
  \begin{align}
    \BE\left[|X_{s}-X_{r}|^{2}|X_{t}-X_{s}|^{2}\right] &\leq C(r-s)(t-s)\\
    &\leq C\frac{(t-r)^{2}}{4}
  \end{align}
  Then $F(t) = t\sqrt{C}/2$ solves the problem.
\end{proof}


\input{magnitudes.tex}

%\input{learningrates.tex}

\input{mcts.tex}
\section{Conclusion}
\label{sec:conclusion}


\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
